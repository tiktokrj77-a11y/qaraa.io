<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Al-Qur’an Digital Profesional</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Scheherazade+New&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap">
<style>
:root {
    --primary-color: #0b0c1a;
    --card-bg: rgba(255,255,255,0.05);
    --accent-color: #00e5ff;
    --accent-dark: #009db3;
    --text-color: #e0e0e0;
    --text-muted: #c0c0c0;
    --highlight-color: #FFD700;
    --shadow-soft: 0 8px 20px rgba(0,0,0,0.5);
}

body {
    margin:0;
    font-family:'Poppins',sans-serif;
    background: var(--primary-color);
    color: var(--text-color);
    min-height:100vh;
}

header {
    background: var(--card-bg);
    color: var(--accent-color);
    padding:15px 20px;
    text-align:center;
    font-weight:700;
    font-size:1.5rem;
    backdrop-filter: blur(12px) saturate(180%);
    border-bottom:1px solid rgba(255,255,255,0.15);
    display:flex;
    flex-direction:column;
    align-items:center;
}

.header-creator {
    font-size:0.65rem;
    font-weight:400;
    color: rgba(255,255,255,0.6);
    margin-top:4px;
    padding:2px 6px;
    border-radius:6px;
    background: rgba(0,0,0,0.2);
}

.hidden { display:none !important; }

#searchBox, #ayahSearchBox {
    margin: 10px 15px;
    background: rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 6px 12px;
    display: flex;
}

#searchBox input,
#ayahSearchBox input {
    flex:1;
    border:none;
    outline:none;
    font-size:0.85rem;
    padding:4px 6px;
    background:transparent;
    color: var(--text-color);
}

#surahList { padding:0 15px; }

.surah-item {
    background: var(--card-bg);
    border-radius:12px;
    margin-bottom:12px;
    padding:15px 18px;
    display:flex;
    align-items:center;
    cursor:pointer;
    box-shadow: var(--shadow-soft);
    transition: transform 0.3s, box-shadow 0.3s;
}

.surah-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.7);
}

.surah-num {
    background: var(--accent-color);
    color:#000;
    border-radius:50%;
    width:40px;
    height:40px;
    display:flex;
    justify-content:center;
    align-items:center;
    margin-right:15px;
    font-weight:700;
}

.surah-info strong { color: var(--accent-color); font-weight:600; }
.surah-meta { font-size:0.8rem; color: var(--text-muted); margin-top:2px; }

#surahDetail { display:none; padding:15px; }

#detailHeader {
    background: var(--card-bg);
    color: var(--accent-color);
    padding:12px 15px;
    border-radius:12px;
    margin-bottom:15px;
    display:flex;
    justify-content:center;
    align-items:center;
    position:relative;
    backdrop-filter: blur(12px) saturate(180%);
    border:1px solid rgba(255,255,255,0.15);
}

#detailHeader h2 { margin:0; font-size:1.3rem; font-weight:700; line-height:1.2; flex-grow:1; margin-left:45px; }

.ayah {
    background: var(--card-bg);
    border-radius:12px;
    margin-bottom:15px;
    padding:20px;
    border:1px solid rgba(255,255,255,0.15);
    cursor:pointer;
    box-shadow: var(--shadow-soft);
    transition: transform 0.3s, border-color 0.3s, background 0.3s, color 0.3s;
}

.ayah:hover { border-color: var(--accent-color); }

.ayah.active {
    background:#000;
    color:#fff;
    border-color: var(--highlight-color);
    transform: scale(1.01);
    box-shadow:0 0 10px rgba(255,255,255,0.2);
}

.ayah.active .ayah-ar {
    color: var(--highlight-color);
    text-shadow:0 0 5px var(--highlight-color),0 0 10px var(--highlight-color);
    animation: shine-simple 1.5s infinite alternate;
}

@keyframes shine-simple {
    from { opacity:0.8; text-shadow:0 0 5px var(--highlight-color);}
    to { opacity:1; text-shadow:0 0 10px var(--highlight-color);}
}

.ayah-num {
    background: var(--accent-color);
    color:#000;
    border-radius:6px;
    padding:4px 10px;
    margin-bottom:15px;
    display:inline-block;
    font-weight:600;
}

.ayah.active .ayah-num { background: var(--highlight-color); color:#000; }

.ayah-ar {
    font-family:'Scheherazade New',serif;
    font-size:2.0rem;
    line-height:2.8rem;
    direction:rtl;
    text-align:right;
    margin:15px 0 20px 0;
    color: var(--text-color);
    font-weight:400;
}

.ayah-id {
    font-size:0.9rem;
    color: var(--text-muted);
    border-top:1px solid rgba(255,255,255,0.1);
    padding-top:15px;
    margin-top:15px;
    font-style:italic;
    line-height:1.8;
    font-weight:300;
}

.ayah.active .ayah-id {
    color: #ccc;
    border-top:1px solid rgba(255,255,255,0.3);
}

#playBtn {
    margin:0 auto 15px auto;
    padding:6px 12px;
    background: var(--accent-color);
    color:#000;
    border:none;
    border-radius:8px;
    font-size:1rem;
    cursor:pointer;
    font-weight:600;
    width:fit-content;
    display:block;
    box-shadow: var(--shadow-soft);
    transition: all 0.3s;
}

#playBtn:hover { background: var(--accent-dark); color:#fff; }

#playBtn.pause {
    background: var(--highlight-color);
    color:#000;
    box-shadow:0 0 0px var(--highlight-color);
    transform:scale(1.02);
}

#backBtn {
    background:none;
    border:none;
    color:#fff;
    font-size:0.7rem;
    line-height:1;
    cursor:pointer;
    padding:0;
    position:absolute;
    left:0px;
    top:50%;
    transform:translateY(-50%);
    font-weight:900;
    opacity:0.9;
    transition:opacity 0.2s;
}

#backBtn:hover { opacity:1; }

#audioPlayer {
    width:100%;
    margin-top:20px;
    border-radius:8px;
    filter: invert(10%) sepia(50%) saturate(1000%) hue-rotate(180deg) brightness(80%) contrast(90%);
}

/* Timer Sleep */
#sleepTimerBox { margin-bottom:5px; }
#sleepTimerBox label { display:block; margin-bottom:4px; font-size:0.8rem; color: var(--accent-color); font-weight:600; }
#sleepTimerInputs { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
#sleepTimerInputs input { width:50px; text-align:center; border:none; border-radius:4px; padding:6px; background:#222; color:#fff; font-size:0.9rem; }
#sleepTimerInputs button { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; transition:0.3s; background: var(--accent-color); color:#000; }
#sleepTimerInputs button.active { background: var(--highlight-color); color:#000; }
#sleepTimerDisplay { display:block; margin-top:6px; font-size:0.85rem; color: var(--text-muted); }

</style>
</head>
<body>

<header>
    <span class="header-creator">Dibuat dengan ❤️ oleh Khenenk Digital</span>
</header>

<div id="listPage">
    <div id="searchBox">
        <input type="text" id="searchInput" placeholder="Cari surah…">
    </div>
    <div id="surahList"></div>
</div>

<div id="surahDetail">
    <div id="sleepTimerBox">
        <label>Atur Waktu Tidur (Jam : Menit : Detik)</label>
        <div id="sleepTimerInputs">
            <input type="number" id="sleepHours" placeholder="0" min="0" value="0">
            <input type="number" id="sleepMinutes" placeholder="0" min="0" value="0">
            <input type="number" id="sleepSeconds" placeholder="0" min="0" value="0">
            <button id="toggleSleepTimer">⏱️ Mulai</button>
        </div>
        <span id="sleepTimerDisplay"></span>
    </div>

    <div id="detailHeader">
        <button id="backBtn">« Kembali</button>
        <h2 id="detailTitle"></h2>
    </div>

    <div id="ayahSearchBox">
        <input type="number" id="ayahSearchInput" placeholder="Cari ayat (misal: 5)">
    </div>

    <button id="playBtn">▶️ Putar Audio Surah</button>

    <div id="ayahContainer"></div>
    <audio id="audioPlayer" controls></audio>
</div>

<script>
// --- Timer Sleep ---
let sleepTimerInterval = null;
let sleepActive = false;
const toggleSleepTimer = document.getElementById('toggleSleepTimer');
const sleepHours = document.getElementById('sleepHours');
const sleepMinutes = document.getElementById('sleepMinutes');
const sleepSeconds = document.getElementById('sleepSeconds');
const sleepTimerDisplay = document.getElementById('sleepTimerDisplay');
const audioPlayer = document.getElementById('audioPlayer');
const playBtn = document.getElementById('playBtn');
const detailEl = document.getElementById('surahDetail');
const listPageEl = document.getElementById('listPage');

function formatTime(h,m,s){return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;}

toggleSleepTimer.onclick = ()=>{
    if(!sleepActive){
        let totalSeconds = parseInt(sleepHours.value)*3600 + parseInt(sleepMinutes.value)*60 + parseInt(sleepSeconds.value);
        if(isNaN(totalSeconds) || totalSeconds<=0){ alert('Masukkan waktu yang valid!'); return; }
        sleepActive=true; toggleSleepTimer.classList.add('active'); toggleSleepTimer.textContent='⏹️ Berhenti';
        sleepTimerDisplay.textContent=`Waktu tersisa: ${formatTime(Math.floor(totalSeconds/3600),Math.floor((totalSeconds%3600)/60),totalSeconds%60)}`;
        sleepTimerInterval=setInterval(()=>{
            totalSeconds--;
            if(totalSeconds<=0){
                clearInterval(sleepTimerInterval);
                sleepActive=false;
                toggleSleepTimer.classList.remove('active');
                toggleSleepTimer.textContent='⏱️ Mulai';
                sleepTimerDisplay.textContent='Timer selesai!';
                audioPlayer.pause();
                detailEl.style.display='none';
                listPageEl.style.display='block';
                playBtn.textContent='▶️ Putar Audio Surah';
                playBtn.classList.remove('pause');
                alert('Waktu tidur selesai. Audio dihentikan.');
            } else {
                sleepTimerDisplay.textContent=`Waktu tersisa: ${formatTime(Math.floor(totalSeconds/3600),Math.floor((totalSeconds%3600)/60),totalSeconds%60)}`;
            }
        },1000);
    }else{
        sleepActive=false; clearInterval(sleepTimerInterval); toggleSleepTimer.classList.remove('active'); toggleSleepTimer.textContent='⏱️ Mulai'; sleepTimerDisplay.textContent='Timer dimatikan';
    }
};

// --- Surah & Audio ---
const apiBase = 'https://api.alquran.cloud/v1';
const listEl = document.getElementById('surahList');
const searchInput = document.getElementById('searchInput');
const detailTitle = document.getElementById('detailTitle');
const ayahContainer = document.getElementById('ayahContainer');
const backBtn = document.getElementById('backBtn');
const ayahSearchInput = document.getElementById('ayahSearchInput');

let surahList = [], currentSurah=null, currentAyahList=[], currentAyahIndex=0, isPlaying=false;

async function loadSurahList() {
  try{
    const res = await fetch(`${apiBase}/surah`);
    const data = await res.json();
    surahList = data.data;
    renderSurahList('');
  }catch(err){
    listEl.innerHTML='<p style="text-align:center;color:red;">Gagal memuat daftar surah.</p>';
  }
}
function renderSurahList(filter){
  listEl.innerHTML='';
  surahList.filter(s=>s.englishName.toLowerCase().includes(filter)||s.name.includes(filter))
    .forEach(s=>{
      const item=document.createElement('div');
      item.className='surah-item';
      item.innerHTML=`<div class="surah-num">${s.number}</div>
      <div class="surah-info"><div><strong>${s.englishName} (${s.name})</strong></div>
      <div class="surah-meta">${s.revelationType.toUpperCase()}</div></div>`;
      item.onclick=()=>openSurah(s.number,s.englishName,s.name);
      listEl.appendChild(item);
    });
}
searchInput.addEventListener('input', e=>renderSurahList(e.target.value.toLowerCase()));

function clearAyahHighlight(){ const active=ayahContainer.querySelector('.ayah.active'); if(active) active.classList.remove('active');}
function highlightAyah(index){ clearAyahHighlight(); const ayahEl=ayahContainer.querySelector(`.ayah[data-index="${index}"]`); if(ayahEl){ayahEl.classList.add('active'); ayahEl.scrollIntoView({behavior:'smooth',block:'center'});}}
async function openSurah(num,engName,arabName){
  currentSurah=num;
  listPageEl.style.display='none';
  detailEl.style.display='block';
  detailTitle.textContent=`${engName} (${arabName})`;
  ayahContainer.innerHTML='<p style="text-align:center;color:#555;">Memuat...</p>';
  currentAyahList=[]; currentAyahIndex=0; isPlaying=false; ayahSearchInput.value=''; playBtn.textContent='▶️ Putar Audio Surah'; playBtn.classList.remove('pause'); clearAyahHighlight();
  try{
    const [arRes,idRes]=await Promise.all([fetch(`${apiBase}/surah/${num}/quran-uthmani`), fetch(`${apiBase}/surah/${num}/id.indonesian`)]);
    const arData=(await arRes.json()).data;
    const idData=(await idRes.json()).data;
    ayahContainer.innerHTML='';
    currentAyahList=arData.ayahs.map(a=>a.number);
    arData.ayahs.forEach((a,i)=>{
      let arabText=a.text.replace(/^بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ\s*/u,'');
      const div=document.createElement('div'); div.className='ayah'; div.dataset.index=i; div.dataset.global=a.number;
      div.innerHTML=`<div class="ayah-num">${a.numberInSurah}</div><div class="ayah-ar">${arabText}</div><div class="ayah-id">${idData.ayahs[i].text}</div>`;
      div.onclick=()=>playFromAyah(i);
      ayahContainer.appendChild(div);
    });
  }catch(err){ayahContainer.innerHTML='<p style="text-align:center;color:red;">Gagal memuat data surah.</p>';}
}

function playFromAyah(index){ if(isPlaying) audioPlayer.pause(); currentAyahIndex=index; playCurrentAyah(); }
function playCurrentAyah(){
    if(currentAyahIndex>=currentAyahList.length){ isPlaying=false; playBtn.classList.remove('pause'); playBtn.textContent='▶️ Putar Audio Surah'; clearAyahHighlight(); return; }
    const globalAyahNum=currentAyahList[currentAyahIndex];
    audioPlayer.src=`https://cdn.islamic.network/quran/audio/128/ar.alafasy/${globalAyahNum}.mp3`;
    audioPlayer.play(); isPlaying=true; playBtn.textContent='⏸️ Jeda Audio Surah'; playBtn.classList.add('pause'); highlightAyah(currentAyahIndex);
}

playBtn.onclick=()=>{if(!currentSurah) return; if(isPlaying){audioPlayer.pause(); isPlaying=false; playBtn.textContent='▶️ Putar Audio Surah'; playBtn.classList.remove('pause');}else{if(audioPlayer.paused&&currentAyahIndex===0) playCurrentAyah(); else {audioPlayer.play(); isPlaying=true; playBtn.textContent='⏸️ Jeda Audio Surah'; playBtn.classList.add('pause');}}};
audioPlayer.addEventListener('ended',()=>{if(isPlaying){currentAyahIndex++; playCurrentAyah();}});
backBtn.onclick=()=>{detailEl.style.display='none'; listPage.style.display='block'; audioPlayer.pause(); isPlaying=false; clearAyahHighlight(); playBtn.textContent='▶️ Putar Audio Surah'; playBtn.classList.remove('pause');};
ayahSearchInput.addEventListener('input',(e)=>{const searchText=e.target.value.trim();const ayahElements=ayahContainer.querySelectorAll('.ayah'); clearAyahHighlight(); if(searchText==='') return; const foundAyah=Array.from(ayahElements).find(ayahEl=>ayahEl.querySelector('.ayah-num').textContent.trim()===searchText); if(foundAyah){const index=parseInt(foundAyah.dataset.index,10); highlightAyah(index); foundAyah.scrollIntoView({behavior:'smooth',block:'center'});}});
loadSurahList();
</script>

</body>
</html>
